cmake_minimum_required(VERSION 3.14)

project(process_monitor_ffi LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Define the FFI library
add_library(process_monitor SHARED
  "process_monitor_api.h"
  "process_monitor_api.cpp"
)

# Set compiler definitions
target_compile_definitions(process_monitor PRIVATE BUILDING_PROCESS_MONITOR_DLL)

# Link libraries
target_link_libraries(process_monitor PRIVATE
  wbemuuid.lib
  ole32.lib
  oleaut32.lib
)

# Set properties for Windows DLL export
if(WIN32)
  set_target_properties(process_monitor PROPERTIES
    WINDOWS_EXPORT_ALL_SYMBOLS ON
  )
endif()